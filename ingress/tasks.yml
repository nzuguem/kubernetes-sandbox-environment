version: 3

tasks:
  ingress-nginx:install:
    desc: Install Ingress Nginx.
    cmds:
      - helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
      - helm repo update ingress-nginx
      - helm upgrade --install ingress-nginx ingress-nginx/ingress-nginx
        --version 4.10.1
        --namespace ingress-nginx-system
        --create-namespace
        --values https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/hack/manifest-templates/provider/kind/values.yaml
      ## Wait for Nginx controller deployment to be Ready
      - kubectl rollout status -n ingress-nginx-system deploy/ingress-nginx-controller --timeout 90s

  ingress-nginx:uninstall:
    desc: Unistall Ingress Nginx
    cmd: helm del -n ingress-nginx-system ingress-nginx

  nginx-ingress:install:
    desc: Install Nginx Ingress.
    cmds:
      - helm repo add nginx-ingress https://helm.nginx.com/stable
      - helm repo update nginx-ingress
      - helm upgrade --install nginx-ingress nginx-ingress/nginx-ingress
        --version 2.4.4
        --namespace nginx-ingress-system
        --create-namespace
        --values nginx/helm.nginx-ingress.values.yml

  nginx-ingress:uninstall:
    desc: Unistall Ingress Nginx
    cmd: helm del -n nginx-ingress-system nginx-ingress
  
  ngrok-install:
    desc: Install Ngrok Ingress Controller.
    cmds:
      - helm repo add ingress-ngrok https://ngrok.github.io/kubernetes-ingress-controller
      - helm repo update ingress-ngrok
      - helm upgrade --install ngrok-ingress-controller ingress-ngrok/kubernetes-ingress-controller
        --namespace ingress-ngrok-system
        --create-namespace
        --set credentials.apiKey=$NGROK_API_KEY
        --set credentials.authtoken=$NGROK_AUTHTOKEN
  
  ngrok-uninstall:
    desc: Uninstall Ngrok Ingress Controller.
    cmd: helm del -n ingress-ngrok-system ngrok-ingress-controller